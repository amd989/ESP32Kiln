<!DOCTYPE html>
<html lang="en">

<head>
      <title>ESP32Kiln Preferences</title>
      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
      <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
      <script type="text/javascript" src="js/nav.js"></script>
      <script type="text/javascript" src="js/programs.js"></script>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>

<body>
      <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid">
                  <a class="navbar-brand" href="#">ESP32Kiln </a>
                  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                  </button>
                  <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav">
                              <li class="nav-item">
                                    <a class="nav-link" href="/index.html">Main view</a>
                              </li>
                              <li class="nav-item">
                                    <a class="nav-link" href="/programs/index.html">Manage programs</a>
                              </li>
                              <li class="nav-item">
                                    <a class="nav-link" href="/logs/index.html">Logs</a>
                              </li>
                              <li class="nav-item">
                                    <a class="nav-link active" href="/preferences.html">Preferences</a>
                              </li>
                              <li class="nav-item">
                                    <a class="nav-link" href="/about.html">About</a>
                              </li>
                              <li class="nav-item">
                                    <a class="nav-link" href="/debug_board.html">Debug ESP</a>
                              </li>
                              <li class="nav-item">
                                    <a class="nav-link" href="/flash_firmware.html">Flash firmware</a>
                              </li>
                        </ul>
                        <ul class="navbar-nav flex-row flex-wrap ms-md-auto">
                              <li class="nav-item dropdown">
                                    <button
                                          class="btn btn-link nav-link py-2 px-0 px-lg-2 dropdown-toggle d-flex align-items-center"
                                          id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown"
                                          data-bs-display="static" aria-label="Toggle theme (auto)">
                                          <i class="bi my-1 theme-icon-active bi-circle-half"></i>
                                          <span class="d-lg-none ms-2" id="bd-theme-text">Toggle theme</span>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
                                          <li>
                                                <button type="button" class="dropdown-item d-flex align-items-center"
                                                      data-bs-theme-value="light" aria-pressed="false">
                                                      <i class="bi me-2 opacity-50 bi-sun-fill"></i>
                                                      Light
                                                      <i class="bi ms-auto d-none bi-check2"></i>
                                                </button>
                                          </li>
                                          <li>
                                                <button type="button" class="dropdown-item d-flex align-items-center"
                                                      data-bs-theme-value="dark" aria-pressed="false">
                                                      <i class="bi me-2 opacity-50 bi-moon-stars-fill"></i>
                                                      Dark
                                                      <i class="bi ms-auto d-none bi-check2"></i>
                                                </button>
                                          </li>
                                          <li>
                                                <button type="button"
                                                      class="dropdown-item d-flex align-items-center active"
                                                      data-bs-theme-value="auto" aria-pressed="true">
                                                      <i class="bi me-2 opacity-50 bi-circle-half"></i>
                                                      Auto
                                                      <i class="bi ms-auto d-none bi-check2"></i>
                                                </button>
                                          </li>
                                    </ul>
                              </li>
                        </ul>
                  </div>
            </div>
      </nav>

      <div class="container">
            ~ERRORS~
            <form method="post" action="preferences.html">
                  <fieldset class="border p-2">
                        <legend class="w-auto"> WiFi configuration </legend>
                        <div class="mb-3 row">
                              <label for="WiFi_SSID" class="col-sm-3 col-form-label"> WiFi access point SSID </label>
                              <div class="col-sm-9">
                                    <input type="text" class="form-control" name="WiFi_SSID" value="~WiFi_SSID~"
                                          title="Name of your WiFi network, that ESP32Kiln should connect to">
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="WiFi_Password" class="col-sm-3 col-form-label"> WiFi AP password </label>
                              <div class="col-sm-9">
                                    <div class="input-group">
                                          <input type="password" class="form-control" id="WiFi_Password"
                                                name="WiFi_Password" value="~WiFi_Password~"
                                                title="Password for WiFi network">
                                          <button class="btn btn-outline-secondary" type="button"
                                                id="WiFi_Password_toggler" onclick="toggle_password(WiFi_Password)">
                                                <i class="bi bi-eye-slash" id="togglePassword"
                                                      alt="Toggle Password"></i>
                                          </button>
                                    </div>
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="WiFi_Mode" class="col-sm-3 col-form-label"> WiFi Mode </label>
                              <div class="col-sm-9">
                                    <div class="form-check">
                                          <input class="form-check-input" type="radio" name="WiFi_Mode" value="0"
                                                ~WiFi_Mode0~>
                                          <label class="form-check-label"> 0 - no WiFi </label>
                                    </div>
                                    <div class="form-check">
                                          <input class="form-check-input" type="radio" name="WiFi_Mode" value="1"
                                                ~WiFi_Mode1~>
                                          <label class="form-check-label"> 1 - connect to AP - if failed, be AP
                                                (default) </label>
                                    </div>
                                    <div class="form-check">
                                          <input class="form-check-input" type="radio" name="WiFi_Mode" value="2"
                                                ~WiFi_Mode2~>
                                          <label class="form-check-label"> 2 - connect only to AP </label>
                                    </div>
                                    <div class="form-check">
                                          <input class="form-check-input" type="radio" name="WiFi_Mode" value="3"
                                                ~WiFi_Mode3~>
                                          <label class="form-check-label"> 3 - be only AP </label>
                                    </div>
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="WiFi_Retry_cnt" class="col-sm-3 col-form-label"> WiFi connection timeout
                                    <br><sup>(0 - unlimited)</sup> </label>
                              <div class="col-sm-9">
                                    <div class="input-group">
                                          <input type="number" class="form-control" name="WiFi_Retry_cnt"
                                                value="~WiFi_Retry_cnt~" min="0" max="254"
                                                title="How many times retry connecting to WiFi (once per second)">
                                          <span class="input-group-text"> seconds</span>
                                    </div>
                              </div>
                        </div>
                  </fieldset>

                  <fieldset class="border p-2">
                        <legend class="w-auto"> HTTP server configuration </legend>
                        <div class="mb-3 row">
                              <label for="Auth_Username" class="col-sm-3 col-form-label"> Auth Username </label>
                              <div class="col-sm-9">
                                    <input type="text" class="form-control" name="Auth_Username" value="~Auth_Username~"
                                          title="Username for your ESP32Kiln authentication">
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="Auth_Password" class="col-sm-3 col-form-label"> Auth Password </label>
                              <div class="col-sm-9">
                                    <div class="input-group">
                                          <input type="password" class="form-control" id="Auth_Password"
                                                name="Auth_Password" value="~Auth_Password~">
                                          <button class="btn btn-outline-secondary" type="button"
                                                id="Auth_Password_toggler" onclick="toggle_password(Auth_Password)">
                                                <i class="bi bi-eye-slash" id="togglePassword"
                                                      alt="Toggle Password"></i>
                                          </button>
                                    </div>
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="HTTP_Local_JS" class="col-sm-3 col-form-label"> Send large JS from local
                                    server<br>(change requires restart) </label>
                              <div class="col-sm-9">
                                    <div class="form-check">
                                          <input class="form-check-input" type="radio" name="HTTP_Local_JS" value="0"
                                                ~HTTP_Local_JS0~
                                                title="Should large JS files be fetched from Internet or directly from ESP32">
                                          <label class="form-check-label"> Redirect to Internet sources (recommended)
                                          </label>
                                    </div>
                                    <div class="form-check">
                                          <input class="form-check-input" type="radio" name="HTTP_Local_JS" value="1"
                                                ~HTTP_Local_JS1~>
                                          <label class="form-check-label"> Send from local HTTP server </label>
                                    </div>
                              </div>
                        </div>
                  </fieldset>

                  <fieldset class="border p-2">
                        <legend class="w-auto"> Time configuration </legend>
                        <div class="mb-3 row">
                              <label for="NTP_Server1" class="col-sm-3 col-form-label"> NTP Server1 </label>
                              <div class="col-sm-9">
                                    <input type="text" class="form-control" name="NTP_Server1" value="~NTP_Server1~"
                                          title="IP of the NTP server to synchronize time">
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="NTP_Server2" class="col-sm-3 col-form-label"> NTP Server2 </label>
                              <div class="col-sm-9">
                                    <input type="text" class="form-control" name="NTP_Server2" value="~NTP_Server2~"
                                          title="IP of the NTP server to synchronize time">
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="NTP_Server3" class="col-sm-3 col-form-label"> NTP Server3 </label>
                              <div class="col-sm-9">
                                    <input type="text" class="form-control" name="NTP_Server3" value="~NTP_Server3~"
                                          title="IP of the NTP server to synchronize time">
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="GMT_Offset_sec" class="col-sm-3 col-form-label"> Difference (in seconds) from
                                    GMT time </label>
                              <div class="col-sm-9">
                                    <input type="number" class="form-control" name="GMT_Offset_sec" min="-39600"
                                          max="50400" value="~GMT_Offset_sec~"
                                          title="Difference between your timezone and GMT in seconds">
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="Daylight_Offset_sec" class="col-sm-3 col-form-label"> Daylight Saving Time
                                    difference (in seconds) </label>
                              <div class="col-sm-9">
                                    <input type="number" class="form-control" name="Daylight_Offset_sec" min="-3600"
                                          max="3600" value="~Daylight_Offset_sec~">
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="Initial_Date" class="col-sm-3 col-form-label"> Initial date - if no NTP
                              </label>
                              <div class="col-sm-9">
                                    <input type="date" class="form-control" name="Initial_Date" value="~Initial_Date~"
                                          title="What date should be assumed after boot, if no Internet and NTP servers">
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="Initial_Time" class="col-sm-3 col-form-label"> Initial time - if no NTP
                              </label>
                              <div class="col-sm-9">
                                    <input type="time" class="form-control" name="Initial_Time" value="~Initial_Time~"
                                          step="1"
                                          title="What time should be assumed after boot, if no Internet and NTP servers">
                              </div>
                        </div>
                  </fieldset>

                  <fieldset class="border p-2">
                        <legend class="w-auto"> Program configuration </legend>

                        <div class="mb-3">
                              <label for="LOG_Window" class="col-sm-3 col-form-label"> Program logging window </label>
                              <div class="input-group">
                                    <input type="number" class="form-control" name="LOG_Window" min="0" max="3600"
                                          step="1" value="~LOG_Window~"
                                          title="How often, during program run, ESP32Kiln should log current status to csv file">
                                    <span class="input-group-text">s</span>
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="LOG_Files_Limit" class="col-sm-3 col-form-label"> Program log files limit
                              </label>
                              <div class="col-sm-9">
                                    <input type="number" class="form-control" name="LOG_Files_Limit" min="0" max="3600"
                                          step="1" value="~LOG_Files_Limit~"
                                          title="How many log files should be keep on drive">
                              </div>
                        </div>
                  </fieldset>

                  <fieldset class="border p-2">
                        <legend class="w-auto"> PID configuration </legend>
                        <div class="mb-3 row">
                              <label for="PID_Algorithm" class="col-sm-3 col-form-label"> PID Algorithm </label>
                              <div class="col-sm-6">
                                    <select id="PID_Algorithm" class="form-select">
                                          <option value="0"> ~PID_Algorithm0~ </option>
                                    </select>
                              </div>
                              <div class="col-sm-3">
                                    <input type="button" name="PID_Auto" value="Auto PID"
                                          class="btn btn-outline-secondary" title="Automatically Calculate PID Values">
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="PID_Window" class="col-sm-3 col-form-label"> PID Window size (ms) </label>
                              <div class="col-sm-9">
                                    <div class="input-group ">
                                          <input type="number" name="PID_Window" class="form-control" min="1" max="9999"
                                                value="~PID_Window~"
                                                title="Time window used to recalculate PID parameters">
                                          <span class="input-group-text"> ms</span>
                                    </div>
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="PID_Measure_Interval" class="col-sm-3 col-form-label"> PID Window size (ms) </label>
                              <div class="col-sm-9">
                                    <div class="input-group ">
                                          <input type="number" name="PID_Measure_Interval" class="form-control" min="1" max="9999"
                                                value="~PID_Measure_Interval~"
                                                title="Time window used to recalculate PID parameters">
                                          <span class="input-group-text"> ms</span>
                                    </div>
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="PID_Kp" class="col-sm-3 col-form-label"> PID Kp (Proportional) </label>
                              <div class="col-sm-9">
                                    <input type="number" name="PID_Kp" class="form-control" min="0" max="999" step="0.1"
                                          value="~PID_Kp~">
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="PID_Ki" class="col-sm-3 col-form-label"> PID Ki (Integral) </label>
                              <div class="col-sm-9">
                                    <input type="number" name="PID_Ki" class="form-control" min="0" max="999" step="0.1"
                                          value="~PID_Ki~">
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="PID_Kd" class="col-sm-3 col-form-label"> PID Kd (Derivative) </label>
                              <div class="col-sm-9">
                                    <input type="number" name="PID_Kd" class="form-control" min="0" max="999" step="0.1"
                                          value="~PID_Kd~">
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="PID_POE" class="col-sm-3 col-form-label"> Proportional on Measurement or Error
                              </label>
                              <div class="col-sm-9">
                                    <div class="form-check">
                                          <input class="form-check-input" type="radio" name="PID_POE" value="0"
                                                ~PID_POE0~>
                                          <label class="form-check-label"> Proportional on Measurement </label>
                                    </div>
                                    <div class="form-check">
                                          <input class="form-check-input" type="radio" name="PID_POE" value="1"
                                                ~PID_POE1~>
                                          <label class="form-check-label"> Proportional on Error </label>
                                    </div>
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="PID_Temp_Threshold" class="col-sm-3 col-form-label"> Temperature threshold
                              </label>
                              <div class="col-sm-9">
                                    <input type="number" name="PID_Temp_Threshold" class="form-control" min="-1"
                                          max="1350" step="1" value="~PID_Temp_Threshold~"
                                          title="If set, and Set temperature is different from Current temperature _that much_ - controller will wait until threshold is reached">
                              </div>
                        </div>
                  </fieldset>


                  <fieldset class="border p-2">
                        <legend class="w-auto"> Safety features </legend>
                        <div class="mb-3 row">
                              <label for="MIN_Temperature" class="col-sm-3 col-form-label"> Minimal temperature </label>
                              <div class="col-sm-9">
                                    <div class="input-group">
                                          <input type="number" class="form-control" name="MIN_Temperature" min="0"
                                                max="50" value="~MIN_Temperature~"
                                                title="Minimal reasonable temperature that can be registered. If below - assume failure">
                                          <span class="input-group-text">°C</span>
                                    </div>
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="MAX_Temperature" class="col-sm-3 col-form-label"> Maximum temperature </label>
                              <div class="col-sm-9">
                                    <div class="input-group">
                                          <input type="number" class="form-control" name="MAX_Temperature" min="51"
                                                max="1350" value="~MAX_Temperature~"
                                                title="Maximum reasonable temperature that can be registered. If above - assume failure">
                                          <span class="input-group-text">°C</span>
                                    </div>
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="MAX_Housing_Temperature" class="col-sm-3 col-form-label"> Maximum housing
                                    temperature </label>
                              <div class="col-sm-9">
                                    <div class="input-group">
                                          <input type="number" class="form-control" name="MAX_Housing_Temperature"
                                                min="10" max="250" value="~MAX_Housing_Temperature~"
                                                title="Maximum allowed housing temperature in normal condition, if above, assume insulation failure">
                                          <span class="input-group-text">°C</span>
                                    </div>
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="Alarm_Timeout" class="col-sm-3 col-form-label"> Alarm timeout </label>
                              <div class="col-sm-9">
                                    <div class="input-group">
                                          <input type="number" class="form-control" name="Alarm_Timeout" min="0"
                                                max="3600" value="~Alarm_Timeout~"
                                                title="How many seconds alarm should be on after program ends or error">
                                          <span class="input-group-text">seconds</span>
                                    </div>
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="MAX31855_Error_Grace_Count" class="col-sm-3 col-form-label"> MAX31855 error
                                    grace count </label>
                              <div class="col-sm-9">
                                    <input type="number" class="form-control" name="MAX31855_Error_Grace_Count" min="0"
                                          max="250" value="~MAX31855_Error_Grace_Count~"
                                          title="How many failed sensor readings, in a row, we can tolerate without aborting">
                              </div>
                        </div>
                  </fieldset>

                  <fieldset class="border p-2">
                        <legend class="w-auto"> Monitoring </legend>
                        <div class="mb-3 row">
                              <label for="DBG_Serial" class="col-sm-3 col-form-label"> Use serial console output
                              </label>
                              <div class="col-sm-9">
                                    <select class="form-select" name="DBG_Serial"
                                          title="Should we output monitoring to serial console?">
                                          <option value="0" ~DBG_Serial0~> no </option>
                                          <option value="1" ~DBG_Serial1~> yes </option>
                                    </select>
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="DBG_Syslog" class="col-sm-3 col-form-label"> Use remote Syslog output </label>
                              <div class="col-sm-9">
                                    <select class="form-select" name="DBG_Syslog"
                                          title="Should we output monitoring to remote syslog server?">
                                          <option value="0" ~DBG_Syslog0~> no </option>
                                          <option value="1" ~DBG_Syslog1~> yes </option>
                                    </select>
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="DBG_Syslog_Srv" class="col-sm-3 col-form-label"> Syslog host IP </label>
                              <div class="col-sm-9">
                                    <input type="text" class="form-control" name="DBG_Syslog_Srv"
                                          value="~DBG_Syslog_Srv~" title="IP of the syslog server">
                              </div>
                        </div>
                        <div class="mb-3 row">
                              <label for="DBG_Syslog_Port" class="col-sm-3 col-form-label"> Syslog UDP port </label>
                              <div class="col-sm-9">
                                    <input type="number" class="form-control" name="DBG_Syslog_Port" min="1" max="49151"
                                          value="~DBG_Syslog_Port~" placeholder="514"
                                          title="Port number for syslog service on remote host">
                              </div>
                        </div>
                  </fieldset>

                  <div class="row mb-3">
                        <div class="col">
                              <input type="submit" class="btn btn-primary" name="update" value="Remember changes"
                                    title="For this session only">
                        </div>
                        <div class="col text-end">
                              <input type="submit" class="btn btn-success" name="save" value="Save preferences"
                                    title="Write it on disk">
                        </div>
                  </div>
            </form>
      </div>
      <div>You can also <a href="/etc/pidkiln.conf" target="_blank">download</a> current /etc/pidkiln.conf file.</div>
      <br>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>

</body>

</html>